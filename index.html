<!DOCTYPE html>

<html lang="en-us">
<head>
<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>Unity WebGL Player | Skibidi Toilet HordeV2</title>
<link rel="shortcut icon" href="TemplateData/favicon.ico"/>
<link rel="stylesheet" href="TemplateData/style.css"/>
<link rel="manifest" href="manifest.webmanifest"/>
</head>
<body>
<div id="unity-container">
<canvas id="unity-canvas" width="960" height="600" tabindex="-1"></canvas>
<div id="unity-loading-bar">
<div id="unity-logo"></div>
<div id="unity-progress-bar-empty">
<div id="unity-progress-bar-full"></div>
</div>
</div>
<div id="unity-warning"> </div>
</div>
<script>
    window.addEventListener("load", function () {
      if ("serviceWorker" in navigator) {
        navigator.serviceWorker.register("ServiceWorker.js");
      }
    });

    var container = document.querySelector("#unity-container");
    var canvas = document.querySelector("#unity-canvas");
    var loadingBar = document.querySelector("#unity-loading-bar");
    var progressBarFull = document.querySelector("#unity-progress-bar-full");
    var warningBanner = document.querySelector("#unity-warning");

    // Shows a temporary message banner/ribbon for a few seconds, or
    // a permanent error message on top of the canvas if type=='error'.
    // If type=='warning', a yellow highlight color is used.
    // Modify or remove this function to customize the visually presented
    // way that non-critical warnings and error messages are presented to the
    // user.
    function unityShowBanner(msg, type) {
      function updateBannerVisibility() {
        warningBanner.style.display = warningBanner.children.length ? 'block' : 'none';
      }
      var div = document.createElement('div');
      div.innerHTML = msg;
      warningBanner.appendChild(div);
      if (type == 'error') div.style = 'background: red; padding: 10px;';
      else {
        if (type == 'warning') div.style = 'background: yellow; padding: 10px;';
        setTimeout(function () {
          warningBanner.removeChild(div);
          updateBannerVisibility();
        }, 5000);
      }
      updateBannerVisibility();
    }

    var buildUrl = "Build";
    var loaderUrl = buildUrl + "/YouVsSkibidi_Yandex2.loader.js";
    var config = {
      dataUrl: buildUrl + "/YouVsSkibidi_Yandex2.data.unityweb",
      frameworkUrl: buildUrl + "/YouVsSkibidi_Yandex2.framework.js.unityweb",
      codeUrl: buildUrl + "/YouVsSkibidi_Yandex2.wasm.unityweb",
      streamingAssetsUrl: "StreamingAssets",
      companyName: "DefaultCompany",
      productName: "Skibidi Toilet HordeV2",
      productVersion: "1.0",
      showBanner: unityShowBanner,
    };

    // By default Unity keeps WebGL canvas render target size matched with
    // the DOM size of the canvas element (scaled by window.devicePixelRatio)
    // Set this to false if you want to decouple this synchronization from
    // happening inside the engine, and you would instead like to size up
    // the canvas DOM size and WebGL render target sizes yourself.
    // config.matchWebGLToCanvasSize = false;

    if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
      // Mobile device style: fill the whole browser client area with the game canvas:
      var meta = document.createElement('meta');
      meta.name = 'viewport';
      meta.content = 'width=device-width, height=device-height, initial-scale=1.0, user-scalable=no, shrink-to-fit=yes';
      document.getElementsByTagName('head')[0].appendChild(meta);
      config.devicePixelRatio = 1.5;
      window.devicePixelRatio = 1.5;
    }

    canvas.style.background = "url('" + buildUrl + "/YouVsSkibidi_Yandex2.jpg.unityweb') center / cover";
    loadingBar.style.display = "block";

    var script = document.createElement("script");
    script.src = loaderUrl;
    script.onload = () => {
      createUnityInstance(canvas, config, (progress) => {
        progressBarFull.style.width = 100 * progress + "%";
      }).then((unityInstance) => {
        window.unityInstance = unityInstance;
        loadingBar.style.display = "none";
      }).catch((message) => {
        alert(message);
      });
    };
    document.body.appendChild(script);
  </script>
<script src="/sdk.js"></script>
<script type="text/javascript">
    var player = null;
    var sdk;
    var payments = null;
    var SHOW_ADS = true;

    YaGames.init({
      adv: {
        onAdvClose: wasShown => {
          console.info('adv closed!');
        }
      }
    })
      .then(ysdk => {
        sdk = ysdk;
        ysdk.getPlayer({ signed: true }).then(_player => {
          player = _player;
        }).catch(err => {
        });
        ysdk.getPayments({ signed: true }).then(_payments => {
          payments = _payments;
          console.log("Purchasing True");
        }).catch(err => {
        })
        if (SHOW_ADS) {
          sdk.adv.showFullscreenAdv({ callbacks: {} });
          //sdk.adv.showBannerAdv();
        }
        else {
          //sdk.adv.hideBannerAdv();
        }
      });

    function checkCom() {
      var isCom = 0;
      var output;

      if (sdk != null) {
        var output = sdk.environment.i18n.tld;
        if (output == "com") {
          isCom = 1;
        } else if (output == "com.tr") {
          isCom = 2;
        }

        var output2 = sdk.environment.i18n.tld;
        if (output2 == "fr")
          isCom = 3;
      }

      console.log(output);
      console.log(isCom);

      window.unityInstance.SendMessage('GameManager', 'IsCom', isCom);
      //checkLanguage();
    }

    function purchaseComplete(id) {
      if (id == 4) {
        SHOW_ADS = false;
        sdk.adv.hideBannerAdv();
      }
    }

    function checkShop() {
      console.log("checkShop");
      payments.getPurchases().then(purchases => {
        if (purchases.some(purchase => purchase.productID === 'minigun')) {
          window.unityInstance.SendMessage('SDKPlatform', 'IAPApply', 0);
        }
        if (purchases.some(purchase => purchase.productID === 'rpg')) {
          window.unityInstance.SendMessage('SDKPlatform', 'IAPApply', 1);
        }
        if (purchases.some(purchase => purchase.productID === 'no_healph')) {
          window.unityInstance.SendMessage('SDKPlatform', 'IAPApply', 2);
        }
        if (purchases.some(purchase => purchase.productID === 'endless_ammo')) {
          window.unityInstance.SendMessage('SDKPlatform', 'IAPApply', 3);
        }
      }).catch(err => {

      })
    }

    function initPurchasing() {
      console.log('Get Purchasing Data....');
      if (payments != null) {
        var gameShop = []
        payments.getCatalog().then(products => {
          gameShop = products;
          console.log('Get Catalog Data....');
          gameShop.forEach(product => {
            window.unityInstance.SendMessage('SDKPlatform', 'PurchaseDataId', product.id);
            window.unityInstance.SendMessage('SDKPlatform', 'PurchaseDataPrice', product.priceValue);
            console.log(product.id + ' ' + product.price);
          });
        });
        payments.getPurchases().then(purchases => purchases.forEach(consumePurchase));
      }
    }

    function consumePurchase(purchase) {
      window.unityInstance.SendMessage('SDKPlatform', 'PurchasesComplete', purchase.id);
      payments.consumePurchase(purchase.purchaseToken)
    }


    function buy(id_buy) {
      if (payments != null) {
        payments.purchase({ id: id_buy }).then(purchase => {
          window.unityInstance.SendMessage('SDKPlatform', 'PurchasesComplete', id_buy);
          if (id_buy != 'minigun' &&
            id_buy != 'rpg' &&
            id_buy != 'no_healph' &&
            id_buy != 'endless_ammo') {
            payments.consumePurchase(purchase.purchaseToken);
          }
          plsSendGoal(id_buy);
        });
      }
    }

    function checkSave() {
      loadData();
      checkCom();
      if (payments != null) {
        initPurchasing();
        checkShop();
      }
      //checkLanguage();
    }

    function checkLanguage() {
      var currentLanguage = 0;
      var output;

      if (sdk != null) {
        var output = sdk.environment.i18n.lang;
        if (output == "ru" || output == "kk" || output == "uz")
          currentLanguage = 1;
        else if (output == "en")
          currentLanguage = 0;
        else if (output == "de")
          currentLanguage = 2;
        else if (output == "ja")
          currentLanguage = 4;
        else if (output == "fr")
          currentLanguage = 3;
        else if (output == "zh")
          currentLanguage = 5;
        else if (output == "ko")
          currentLanguage = 6;
        else if (output == "es")
          currentLanguage = 7;
        else if (output == "pt")
          currentLanguage = 8;
        else if (output == "hi")
          currentLanguage = 9;
        else if (output == "it")
          currentLanguage = 10;
        else if (output == "tr")
          currentLanguage = 11;
        else if (output == "ar")
          currentLanguage = 12;
        else if (output == "id")
          currentLanguage = 13;
        else if (output == "th")
          currentLanguage = 14;
        else if (output == "vi")
          currentLanguage = 15;
        else if (output == "pl")
          currentLanguage = 16;
        else if (output == "uk")
          currentLanguage = 17;
        else if (output == "br")
          currentLanguage = 18;
        else
          currentLanguage = -1;

        var output2 = sdk.environment.i18n.tld;
        if (output2 == "fr")
          currentLanguage = 3;
      }

      console.log(output);
      console.log(output2);
      console.log("Language: " + currentLanguage);

      window.unityInstance.SendMessage('GameManager', 'SetLanguage', currentLanguage);
    }

    function loadData() {
      if (player != null) {
        console.log("Loading......")
        player.getData(["saveYouVsSkibidi"]).then(data => {
          if (data.saveYouVsSkibidi) {
            console.log("Load")
            window.unityInstance.SendMessage('SDKPlatform', 'LoadCloud', data.saveYouVsSkibidi);
          }
          else {
            console.log('No Save');
          }
        }).catch(() => {
          console.log('No Save');
        });
      }

    }
  </script>
<script>
    function saveCloud(dataSave, counterSave) {
      console.log("Saving....... ");
      if (player != null) {
        player.getData(["saveYouVsSkibidi", "counterSave"]).then(data => {
          if (data.counterSave) {
            console.log('Counter ' + data.counterSave + " " + counterSave);
            if (data.counterSave < counterSave) {
              player.setData({
                saveYouVsSkibidi: dataSave,
                counterSave: counterSave,
              }).then(() => {
                console.log('data is set -update');
              });
            }
          }
          else {
            player.setData({
              saveYouVsSkibidi: dataSave,
              counterSave: counterSave,
            }).then(() => {
              console.log('data is set -first');
            });
          }
        }).catch(() => {
          player.setData({
            saveYouVsSkibidi: dataSave,
            counterSave: counterSave,
          }).then(() => {
            console.log('data is set -first');
          });
        });
      }
    }
  </script>
<script>
    function showFullscrenAd() {
      sdk.adv.showFullscreenAdv({
        callbacks: {
          onOpen: () => {
            window.unityInstance.SendMessage('SDKPlatform', 'AudioEnable', 0);
          },
          onClose: () => {
            window.unityInstance.SendMessage('SDKPlatform', 'AudioEnable', 1);
          },
          onError: (e) => {
            window.unityInstance.SendMessage('SDKPlatform', 'AudioEnable', 1);
          }
        }
      })
    }
  </script>
<script>
    function rate() {
    }
  </script>
<script>
    function showRewardedAd(id) {
      sdk.adv.showRewardedVideo({
        callbacks: {
          onOpen: () => {
            window.unityInstance.SendMessage('SDKPlatform', 'AudioEnable', 0);
          },
          onRewarded: () => {
            window.unityInstance.SendMessage('SDKPlatform', 'BuyComplete', id);
          },
          onClose: () => {
            window.unityInstance.SendMessage('SDKPlatform', 'AudioEnable', 1);
          },
          onError: (e) => {
            window.unityInstance.SendMessage('SDKPlatform', 'AudioEnable', 1);
          }
        }
      })
    }
  </script>
<script type="text/javascript">
    function plsSendGoal(id) {
      ym(94286723, 'reachGoal', id);
      console.log('метрика отправлена: ' + id);
    }
  </script>
</body>
</html>